services:
  ray-head:
    image: ghcr.io/${GIT_NAME}/ml-base:py${PYTHON_VERSION:-3.12}-${VARIANT:-cuda}
    container_name: ray-head
    network_mode: host
    env_file:
      - .env
    command: >
      zsh -c "
      ray start --head \
      --include-dashboard=true \
      --dashboard-host=0.0.0.0 \
      --dashboard-port=8265 \
      --port=6379 \
      --ray-client-server-port=10001 \
      --node-ip-address=0.0.0.0 \
      --block"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    restart: unless-stopped